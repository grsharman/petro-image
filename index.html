<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenSeaDragon Split View Example</title>
    <style>
        body, html {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }
        #viewer-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .controls {
            position: absolute;
            top: 40px;
            left: 5px;
            background-color: rgba(255, 255, 255, 0.5); 
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OpenSeadragonScalebar/2.0.0/openseadragon-scalebar.min.css" />
</head>
<body>
    <div id="viewer-container"></div>
    <div class="controls">
        <input type="checkbox" id="image1" checked onclick="toggleVisibility(this, 0)" />
        <label for="image1">XPL1</label>
        <input type="checkbox" id="image2" checked onclick="toggleVisibility(this, 1)" />
        <label for="image2">XPL2</label>
        <input type="checkbox" id="image3" checked onclick="toggleVisibility(this, 2)" />
        <label for="image3">PPL</label>
    </div>
    <script src="js/openseadragon.min.js"></script>
    <script src="js/openseadragon-scalebar.min.js"></script>
    <script>
        const viewer = OpenSeadragon({
            id: "viewer-container",
            prefixUrl: "js/images/",
            tileSources: [
                "https://raw.githubusercontent.com/grsharman/petro-image/main/images/O48-013.dzi",
                "https://raw.githubusercontent.com/grsharman/petro-image/main/images/O48-013b.dzi",
                "https://raw.githubusercontent.com/grsharman/petro-image/main/images/O48-014.dzi",
            ]
        });

        const viewerContainer = document.getElementById('viewer-container');

        // Share the mouse position between event handlers.
        let mousePos = new OpenSeadragon.Point(0, 0);

        // Divides the images at the current mouse position, clipping overlaid
        // images to expose the images underneath. Note that all images are
        // expected to have the same position and size.
        const divideImages = () => {
            // Get the clip point and clamp it to within the image bounds.
            const image = viewer.world.getItemAt(0)
            const clipPos = image.viewerElementToImageCoordinates(mousePos);
            const size = image.getContentSize();
            clipPos.x = Math.max(0, Math.min(clipPos.x, size.x));
            clipPos.y = Math.max(0, Math.min(clipPos.y, size.y));

            // Set the clip for each image.
            let previousVisibleImages = 0;
            for (let i = 0; i < viewer.world.getItemCount(); ++i) {
                const image = viewer.world.getItemAt(i);
                if (!image.getOpacity()) {
                    continue;
                }
                // Determine the quadrants to be clipped by how many visible
                // images are underneath this one.
                const xClip = previousVisibleImages & 1 ? clipPos.x : 0;
                const yClip = previousVisibleImages & 2 ? clipPos.y : 0;
                image.setClip(new OpenSeadragon.Rect(xClip, yClip, size.x, size.y));
                ++previousVisibleImages;
            }
        };

        const toggleVisibility = (checkbox, idx) => {
            viewer.world.getItemAt(idx).setOpacity(checkbox.checked ? 1 : 0);
            divideImages();
        };

        viewer.addHandler('animation', divideImages);

        viewerContainer.addEventListener('pointermove', event => {
            mousePos = new OpenSeadragon.Point(event.clientX, event.clientY)
            divideImages();
        });

        // Adding scalebar to viewer
        viewer.scalebar({
            type: OpenSeadragon.ScalebarType.MAP,
            pixelsPerMeter: 100000, // Adjust according to your image
            minWidth: "75px",
            location: OpenSeadragon.ScalebarLocation.BOTTOM_LEFT,
            xOffset: 10,
            yOffset: 10,
            stayInsideImage: true,
            color: "black",
            fontColor: "black",
            backgroundColor: "rgba(255, 255, 255, 0.5)",
            fontSize: "small",
            barThickness: 2
        });
    </script>
</body>
</html>
