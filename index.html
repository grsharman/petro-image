<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenSeaDragon Split View Example</title>
    <style>
        body, html {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }
        #viewer-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        #viewer {
            position: absolute;
            height: 100%;
            width: 100%;
        }
        #divider {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: black;
            pointer-events: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OpenSeadragonScalebar/2.0.0/openseadragon-scalebar.min.css" />
</head>
<body>
    <div id="viewer-container">
        <div id="viewer"></div>
        <div id="divider"></div>
    </div>
    <script src="js/openseadragon.min.js"></script>
    <script src="js/openseadragon-scalebar.min.js"></script>
    <script>
        const viewer = OpenSeadragon({
            id: "viewer",
            prefixUrl: "js/images/",
            tileSources: [
                "https://raw.githubusercontent.com/grsharman/petro-image/main/images/O48-013.dzi",
                "https://raw.githubusercontent.com/grsharman/petro-image/main/images/O48-014.dzi",
            ]
        });

        const divider = document.getElementById('divider');
        const viewerContainer = document.getElementById('viewer-container');

        // Keep track of the mouse's position outside the pointermove event so
        // that it's available when handling other events, such as viewer
        // animation.
        let mousePos = new OpenSeadragon.Point(0, 0);

        // Sets the dividing line between the two images at the given
        // x-coordinate in window space.
        const divideAtX = x => {
            // Reposition the divider between the partial images.
            divider.style.left = x + 'px';

            // Clip the overlayed image to show only the region to the right of
            // x, exposing the image underneath.
            const overlay = viewer.world.getItemAt(1);
            const clipPos = overlay.viewerElementToImageCoordinates(new OpenSeadragon.Point(x, 0));
            // Clamp the clip to within the image bounds.
            const size = overlay.getContentSize();
            const xClip = Math.max(0, Math.min(clipPos.x, size.x));
            overlay.setClip(new OpenSeadragon.Rect(xClip, 0, size.x, size.y));
        };
        // Sets the dividing line to the current mouse position.
        const divideAtMouse = () => { divideAtX(mousePos.x); };
        // Sets the dividing line to the center of the window.
        const divideAtCenter = () => { divideAtX(document.body.clientWidth / 2); };

        viewer.addHandler('animation', divideAtMouse);

        viewerContainer.addEventListener('pointermove', event => {
            mousePos = new OpenSeadragon.Point(event.clientX, event.clientY);
            divideAtMouse();
        });

        document.addEventListener('mouseleave', divideAtCenter);

        // Adding scalebar to viewer
        viewer.scalebar({
            type: OpenSeadragon.ScalebarType.MAP,
            pixelsPerMeter: 100000, // Adjust according to your image
            minWidth: "75px",
            location: OpenSeadragon.ScalebarLocation.BOTTOM_LEFT,
            xOffset: 10,
            yOffset: 10,
            stayInsideImage: true,
            color: "black",
            fontColor: "black",
            backgroundColor: "rgba(255, 255, 255, 0.5)",
            fontSize: "small",
            barThickness: 2
        });
    </script>
</body>
</html>
